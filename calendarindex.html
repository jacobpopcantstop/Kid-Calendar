<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>High-Accessibility Calendar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap');

        body {
            font-family: 'Comic Neue', cursive, sans-serif;
            font-size: 25pt;
            overflow-x: hidden;
        }

        /* Prevent text from running over boxes */
        .event-box {
            word-break: break-word;
            overflow-wrap: anywhere;
            hyphens: auto;
            line-height: 1.2;
        }

        /* Maintain grid integrity with scrollable day content */
        .day-content-area {
            max-height: 250px;
            overflow-y: auto;
            scrollbar-width: thin;
        }

        .shadow-neo {
            box-shadow: 6px 6px 0px 0px rgba(0,0,0,1);
        }

        /* Custom scrollbar for large text accessibility */
        ::-webkit-scrollbar {
            width: 16px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #000;
            border-radius: 10px;
            border: 3px solid #f1f1f1;
        }

        @media print {
            .print-hidden { display: none !important; }
            .page-break { page-break-after: always; display: block !important; }
            body { background: white !important; font-size: 18pt !important; }
            .calendar-container { border: none !important; shadow: none !important; }
            * { -webkit-print-color-adjust: exact !important; }
            .day-content-area { max-height: none !important; overflow: visible !important; }
        }

        select {
            background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='4' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 1.5rem center;
            background-size: 2.5rem;
            appearance: none;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 p-4 min-h-screen">

    <div id="app">
        <!-- Toolbar -->
        <header class="max-w-7xl mx-auto mb-8 space-y-6 print-hidden">
            <div class="flex flex-wrap items-center justify-between gap-6">
                <div class="flex items-center gap-4">
                    <div class="bg-blue-600 p-3 rounded-2xl border-4 border-black">
                        <i data-lucide="calendar" class="text-white w-12 h-12"></i>
                    </div>
                    <h1 class="text-6xl font-black tracking-tight">Big Calendar</h1>
                </div>

                <div class="flex gap-4">
                    <button onclick="toggleModal(true)" class="px-8 py-5 bg-green-500 text-white border-4 border-black rounded-3xl font-black shadow-[6px_6px_0px_0px_rgba(0,0,0,1)] active:translate-y-1 active:shadow-none flex items-center gap-3">
                        <i data-lucide="plus" class="w-10 h-10"></i> ADD EVENT
                    </button>
                    <button onclick="window.print()" class="px-8 py-5 bg-blue-500 text-white border-4 border-black rounded-3xl font-black shadow-[6px_6px_0px_0px_rgba(0,0,0,1)] flex items-center gap-3">
                        <i data-lucide="printer" class="w-10 h-10"></i> PRINT
                    </button>
                </div>
            </div>

            <div class="flex flex-wrap items-center justify-between bg-white border-8 border-black p-6 rounded-[40px] gap-6">
                <div class="flex items-center gap-4">
                    <button onclick="changeDate(-1)" class="p-4 border-4 border-black rounded-2xl hover:bg-slate-100">
                        <i data-lucide="chevron-left" class="w-12 h-12"></i>
                    </button>
                    <div id="current-month-display" class="text-center min-w-[350px] font-black text-4xl uppercase underline decoration-yellow-400 decoration-8 underline-offset-8">
                        Loading...
                    </div>
                    <button onclick="changeDate(1)" class="p-4 border-4 border-black rounded-2xl hover:bg-slate-100">
                        <i data-lucide="chevron-right" class="w-12 h-12"></i>
                    </button>
                </div>

                <div class="flex bg-slate-200 p-2 rounded-3xl border-4 border-black">
                    <button id="view-monthly" onclick="setView('monthly')" class="flex items-center gap-2 px-6 py-3 rounded-2xl font-bold bg-white shadow-md">
                        <i data-lucide="layout-grid" class="w-8 h-8"></i> Monthly
                    </button>
                    <button id="view-weekly" onclick="setView('weekly')" class="flex items-center gap-2 px-6 py-3 rounded-2xl font-bold opacity-60">
                        <i data-lucide="list" class="w-8 h-8"></i> Weekly
                    </button>
                </div>
            </div>
        </header>

        <!-- Calendar Main -->
        <main class="max-w-7xl mx-auto bg-white border-8 border-black rounded-[40px] overflow-hidden shadow-[15px_15px_0px_0px_rgba(0,0,0,0.1)] print:border-none print:shadow-none">
            <!-- Headers -->
            <div class="grid grid-cols-7 border-b-8 border-black bg-slate-100" id="weekday-headers">
                <!-- Injected via JS -->
            </div>
            <!-- Grid -->
            <div class="grid grid-cols-7" id="calendar-grid">
                <!-- Injected via JS -->
            </div>
        </main>

        <!-- Task Modal -->
        <div id="task-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4">
            <div class="bg-white border-[10px] border-black rounded-[50px] w-full max-w-3xl overflow-hidden shadow-[20px_20px_0px_0px_rgba(0,0,0,1)]">
                <div class="p-10 bg-yellow-400 border-b-8 border-black flex justify-between items-center">
                    <h2 class="text-6xl font-black">Add Event</h2>
                    <button onclick="toggleModal(false)" class="p-4 bg-white border-4 border-black rounded-full hover:bg-red-400">
                        <i data-lucide="x" class="w-12 h-12"></i>
                    </button>
                </div>
                <div class="p-10 space-y-10 max-h-[70vh] overflow-y-auto">
                    <div class="space-y-4">
                        <label class="block font-black text-4xl">What is happening?</label>
                        <input id="task-title" type="text" class="w-full border-8 border-black p-6 rounded-[30px] text-5xl focus:bg-yellow-50 outline-none" placeholder="Type here...">
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
                        <div class="space-y-4">
                            <label class="block font-black text-4xl">When?</label>
                            <input id="task-date" type="date" class="w-full border-8 border-black p-6 rounded-[30px] text-4xl bg-white">
                        </div>
                        <div class="space-y-4">
                            <label class="block font-black text-4xl">Repeat?</label>
                            <select id="task-recurrence" class="w-full border-8 border-black p-6 rounded-[30px] text-4xl bg-white">
                                <option value="none">None</option>
                                <option value="daily">Daily</option>
                                <option value="weekly">Weekly</option>
                                <option value="monthly">Monthly</option>
                            </select>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <label class="block font-black text-4xl">Category:</label>
                        <div class="grid grid-cols-2 gap-4" id="category-picker">
                            <!-- Injected via JS -->
                        </div>
                    </div>
                    <button onclick="saveTask()" class="w-full py-10 bg-green-500 text-white border-8 border-black rounded-[40px] text-6xl font-black shadow-[10px_10px_0px_0px_rgba(0,0,0,1)] active:shadow-none active:translate-y-2 uppercase">
                        Save Event
                    </button>
                </div>
            </div>
        </div>

        <!-- Print Section (Hidden on UI) -->
        <div id="print-view" class="hidden"></div>
    </div>

    <script>
        // Constants
        const DAYS = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        const CATEGORIES = [
            { id: 'work', label: 'Work', bg: '#dbeafe', border: '#1e40af' },
            { id: 'personal', label: 'Personal', bg: '#fce7f3', border: '#9d174d' },
            { id: 'medical', label: 'Medical', bg: '#d1fae5', border: '#065f46' },
            { id: 'urgent', label: 'Urgent', bg: '#fee2e2', border: '#991b1b' },
        ];

        // State
        let currentDate = new Date();
        let currentView = 'monthly';
        let tasks = JSON.parse(localStorage.getItem('accessible_calendar_v2_html')) || getInitialTasks();
        let selectedCategory = 'personal';

        function getInitialTasks() {
            const now = new Date();
            const year = now.getFullYear();
            const month = now.getMonth();
            return [
                { id: '1', title: 'Morning Walk Around The Park For Fresh Air', date: new Date(year, month, 1).toISOString().split('T')[0], category: 'personal', recurrence: 'daily' },
                { id: '2', title: 'Very Long Weekly Sync Meeting Title That Needs To Wrap Correctly', date: new Date(year, month, 5).toISOString().split('T')[0], category: 'work', recurrence: 'weekly' },
                { id: '3', title: 'Health Check', date: new Date(year, month, 15).toISOString().split('T')[0], category: 'medical', recurrence: 'none' },
                { id: '4', title: 'Pay All Utility Bills', date: new Date(year, month, 1).toISOString().split('T')[0], category: 'urgent', recurrence: 'monthly' }
            ];
        }

        // Logic
        function setView(view) {
            currentView = view;
            document.getElementById('view-monthly').classList.toggle('opacity-60', view !== 'monthly');
            document.getElementById('view-monthly').classList.toggle('shadow-md', view === 'monthly');
            document.getElementById('view-monthly').classList.toggle('bg-white', view === 'monthly');
            
            document.getElementById('view-weekly').classList.toggle('opacity-60', view !== 'weekly');
            document.getElementById('view-weekly').classList.toggle('shadow-md', view === 'weekly');
            document.getElementById('view-weekly').classList.toggle('bg-white', view === 'weekly');
            
            render();
        }

        function changeDate(delta) {
            const d = new Date(currentDate);
            if (currentView === 'monthly') {
                d.setMonth(d.getMonth() + delta);
            } else {
                d.setDate(d.getDate() + (delta * 7));
            }
            currentDate = d;
            render();
        }

        function toggleModal(show) {
            const modal = document.getElementById('task-modal');
            modal.classList.toggle('hidden', !show);
            if (show) {
                document.getElementById('task-date').value = new Date().toISOString().split('T')[0];
                renderCategoryPicker();
            }
        }

        function renderCategoryPicker() {
            const container = document.getElementById('category-picker');
            container.innerHTML = CATEGORIES.map(cat => `
                <button onclick="selectedCategory='${cat.id}'; renderCategoryPicker()" 
                    class="py-6 rounded-[30px] border-8 border-black text-3xl font-black transition-all ${selectedCategory === cat.id ? 'bg-black text-white translate-y-2' : 'bg-white'}"
                    style="border-bottom-width: ${selectedCategory === cat.id ? '8px' : '16px'}">
                    ${cat.label}
                </button>
            `).join('');
        }

        function saveTask() {
            const title = document.getElementById('task-title').value;
            const date = document.getElementById('task-date').value;
            const recurrence = document.getElementById('task-recurrence').value;
            
            if (!title) return;

            tasks.push({
                id: Date.now().toString(),
                title,
                date,
                category: selectedCategory,
                recurrence
            });

            localStorage.setItem('accessible_calendar_v2_html', JSON.stringify(tasks));
            document.getElementById('task-title').value = '';
            toggleModal(false);
            render();
        }

        function deleteTask(id) {
            tasks = tasks.filter(t => t.id !== id);
            localStorage.setItem('accessible_calendar_v2_html', JSON.stringify(tasks));
            render();
        }

        function getTasksForDate(date) {
            const dateStr = date.toISOString().split('T')[0];
            const d = new Date(date);
            d.setHours(0,0,0,0);
            
            return tasks.filter(task => {
                const tStart = new Date(task.date);
                tStart.setHours(0,0,0,0);
                
                if (task.date === dateStr) return true;
                if (task.recurrence === 'none' || d < tStart) return false;

                if (task.recurrence === 'daily') return true;
                if (task.recurrence === 'weekly') return d.getDay() === tStart.getDay();
                if (task.recurrence === 'monthly') return d.getDate() === tStart.getDate();
                return false;
            });
        }

        function generateDays() {
            if (currentView === 'weekly') {
                const days = [];
                const start = new Date(currentDate);
                start.setDate(currentDate.getDate() - currentDate.getDay());
                for (let i = 0; i < 7; i++) {
                    const d = new Date(start);
                    d.setDate(start.getDate() + i);
                    days.push({ date: d, currentMonth: true });
                }
                return days;
            } else {
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth();
                const firstDay = new Date(year, month, 1);
                const offset = firstDay.getDay();
                const days = [];
                
                // Prev Month Padding
                for (let i = 0; i < offset; i++) {
                    const d = new Date(year, month, 1 - (offset - i));
                    days.push({ date: d, currentMonth: false });
                }
                // Current Month
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                for (let i = 1; i <= daysInMonth; i++) {
                    days.push({ date: new Date(year, month, i), currentMonth: true });
                }
                // Next Month Padding
                const total = Math.ceil(days.length / 7) * 7;
                const remaining = total - days.length;
                for (let i = 1; i <= remaining; i++) {
                    const d = new Date(year, month + 1, i);
                    days.push({ date: d, currentMonth: false });
                }
                return days;
            }
        }

        function render() {
            // Header display
            const display = document.getElementById('current-month-display');
            display.innerText = currentDate.toLocaleString('default', { month: 'long', year: 'numeric' }) + (currentView === 'weekly' ? ' (Week)' : '');

            // Weekday Headers
            const headerRow = document.getElementById('weekday-headers');
            headerRow.innerHTML = DAYS.map((day, i) => `
                <div class="p-6 text-center font-black border-r-4 last:border-r-0 border-black ${i === 0 || i === 6 ? 'bg-slate-200 text-slate-500' : ''}">
                    ${day}
                </div>
            `).join('');

            // Grid
            const grid = document.getElementById('calendar-grid');
            const daysToDisplay = generateDays();
            
            grid.className = `grid grid-cols-7 ${currentView === 'weekly' ? 'auto-rows-[600px]' : 'auto-rows-[minmax(220px,auto)]'}`;
            
            grid.innerHTML = daysToDisplay.map((dayObj, idx) => {
                const dateTasks = getTasksForDate(dayObj.date);
                const isToday = new Date().toDateString() === dayObj.date.toDateString();
                const isWeekend = dayObj.date.getDay() === 0 || dayObj.date.getDay() === 6;

                return `
                    <div class="relative border-r-4 border-b-4 border-black p-3 ${!dayObj.currentMonth ? 'bg-slate-50 text-slate-300' : 'bg-white'} ${isWeekend ? 'bg-slate-100/50' : ''} ${isToday ? 'bg-yellow-50' : ''}">
                        <div class="flex justify-between items-start mb-4">
                            <span class="w-12 h-12 flex items-center justify-center rounded-full font-black text-4xl ${isToday ? 'bg-yellow-400 border-4 border-black' : ''}">
                                ${dayObj.date.getDate()}
                            </span>
                        </div>
                        <div class="day-content-area space-y-3">
                            ${dateTasks.map(task => {
                                const cat = CATEGORIES.find(c => c.id === task.category);
                                return `
                                    <div class="event-box p-3 border-4 border-black rounded-2xl flex flex-col group relative" style="background-color: ${cat.bg}">
                                        <div class="font-black text-2xl leading-tight flex items-start gap-2">
                                            ${task.recurrence !== 'none' ? '<i data-lucide="clock" class="w-5 h-5 flex-shrink-0 mt-1"></i>' : ''}
                                            <span class="flex-1">${task.title}</span>
                                        </div>
                                        <button onclick="deleteTask('${task.id}')" class="absolute -top-3 -right-3 bg-red-500 text-white rounded-full p-1 border-4 border-black opacity-0 group-hover:opacity-100 transition-opacity print-hidden">
                                            <i data-lucide="x" class="w-5 h-5"></i>
                                        </button>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
            }).join('');

            lucide.createIcons();
            renderPrint(daysToDisplay);
        }

        function renderPrint(days) {
            const printView = document.getElementById('print-view');
            let html = '';
            for (let i = 0; i < days.length; i += 14) {
                const slice = days.slice(i, i + 14);
                html += `
                    <div class="page-break p-4 mt-10">
                        <h2 class="text-6xl font-black mb-8 border-b-8 border-black pb-4 text-center">
                            ${slice[0].date.toLocaleDateString()} — ${slice[slice.length-1].date.toLocaleDateString()}
                        </h2>
                        <div class="grid grid-cols-7 border-8 border-black">
                            ${DAYS.map(d => `<div class="p-4 border-r-4 border-b-8 border-black font-black text-4xl bg-slate-100 text-center">${d}</div>`).join('')}
                            ${slice.map(d => `
                                <div class="border-r-4 border-b-4 border-black p-4 min-h-[450px]">
                                    <div class="text-6xl font-black mb-4">${d.date.getDate()}</div>
                                    <div class="space-y-4">
                                        ${getTasksForDate(d.date).map(t => `<div class="p-4 border-4 border-black rounded-2xl text-3xl font-black bg-white event-box">• ${t.title}</div>`).join('')}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
            printView.innerHTML = html;
        }

        window.onload = render;
    </script>
</body>
</html>
